## 5.2 类加载的过程
即加载、验证、准备、解析、初始化这5个阶段的具体操作
### 1. 加载
加载阶段，虚拟机需要完成：

1. 通过一个类的全限定名来获取定义该类的二进制字节流
2. 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构
3. 在内存中生成一个代表这个类的 java.lang.Class 对象，作为方法区这个类的各种数据的访问入口

加载阶段完成后，虚拟机外部的二进制字节流就按照虚拟机所需的格式存储在方法区之中，方法区中的数据存储格式由虚拟机自行定义。然后在内存中实例化一个 java.lang.Class 类的对象（对于HotSpot VM 来说，该类最特殊，不在 Java 堆中，而是在方法区中），这个对象将作为程序访问方法区中这些类型数据的外部接口。

### 2. 验证
验证是连接阶段的第一步，目的是为了确保 Class 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。大致会完成4个阶段的检验动作：文件格式验证、元数据验证、字节码验证、符号引用验证。

1. 文件格式验证：检验字节流是否符合 Class 文件格式的规范，并且能被当前版本的虚拟机处理。通过该阶段后，字节流才会进入内存的方法区中存储。
2. 元数据验证。对字节码描述的信息进行语义分析，以保证符合 Java 语言规范。
3. 字节码验证：最复杂的阶段。通过数据流和控制流的分析，确定程序的语义是否合法、符合逻辑。在第2阶段对元数据信息中的数据类型做完校验后，这个阶段将对类的方法体进行校验，保证类的方法在运行时不会危害虚拟机安全。
4. 符号引用验证：最后阶段，发生在虚拟机将符号引用转化为直接引用的时候，这个转化动作将在连接的第三阶段——解析阶段中发生。符号引用验证可以看作是对类自身以外（常量池中的各种符号引用）的信息进行匹配性校验，其目的是确保解析动作能正常执行。

### 3. 准备
准备阶段是正式为类变量（只是被 static 修饰的变量，不包括实例变量）分配内存（在方法区中）并设置类变量初始值的阶段。这里的初始化将所有类变量初始化为**零值**（即便用代码赋过具体值，那也是在 putstatic 指令被程序编译后存放于类构造器 <clinit>() 方法中，在初始化阶段执行）。

